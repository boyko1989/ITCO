# Работа с клавиатурой

Проследим последовательность операций от момента нажатия клавиши до вывода символа на экран:

1. Клавиатура определяет какой **_скан-код_** соответстввует нажатой физической клавише и передаёт его компьютеру.
2. Ядро Linux сопоставляет сканкод с **_кодом клавиши_** (_keycode_)
3. Раскладка клавиатуры в зависимости от нажатых моификаторов сопоставляет код клавиши с **_символом клавиши_** (_keysym_)

Далее идёт обработка вывода: либо символ будет выводить консольная подсистема, либо графическая. В первом случае мы будем работать с пакетом утилит **_kbd_**, а во втором - **_xkb_** (`setxkbmap`, `xkb-switch` и тому подобное).

Я пробовал редактировать файл `/etc/default/keyboard`, но это ничего не даёт и вообще, это неправильно.

Поэтому, чтобы включить переключение раскладки в десктопной Xubuntu, нужно тем не менее зайти в настройки клавиатуры и выключить применение настроек по умолчанию. <span style="color: red;">Нужно найти способ сделать это через терминал!!!</span> Затем мы проверяем какая конфигурация клавиатуры действует на данный момент, в случае отсутствия там информации о вариантах переключения (слово _"toogle"_) в секции **_symbols_** нужно ввести команду для добавления комбинации клавиш для этого.

В конце сохраняем нашу конфигурацию в файл в каталоге `~/.config/xkb/` и в дальнейшем работать будем мы только с ним.

```shell
# вывод конфигурации
setxkbmap -print

# варианты комбинаций клавиш для преключения
setxkbmap -symbols "pc+us+ru:2+inet(evdev)+group(alt_shift_toggle)"
setxkbmap -symbols "pc+us+ru:2+inet(evdev)+capslock(grouplock)"

# сохранение конфигурации
setxkbmap -print > ~/.config/xkb/layout_settings
```

В итоге `~/.config/xkb/layout_settings` у меня выглядит так:

```shell
xkb_keymap {
	xkb_keycodes  { include "evdev+aliases(qwerty)"	};
	xkb_types     { include "complete"	};
	xkb_compat    { include "complete+ledscroll(group_lock)"	};
	xkb_symbols   { include "pc+us+ru:2+inet(evdev)+capslock(grouplock)"	};
	xkb_geometry  { include "pc(pc86)"	};
};
```

А поработать будет с чем. Например в [этой](https://habr.com/ru/post/222285/) статье.
