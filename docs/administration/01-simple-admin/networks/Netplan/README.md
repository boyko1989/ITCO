# Netplan

## Содержание

- [Руководства](tutorials.md)
- [Путеводители](guides.md)
- [Рекомендации](reference.md)
- [Разъяснения](explanation.md)

Netplan - это утилита для простой настроки сети в Linux системах. Для её использования нужно просто создать описание конфигурации на YAML. После этого Netplan сгенерирует все необходимые файлы. Для этого на выбор есть пара инструментов ([NetworkManager](https://help.ubuntu.com/community/NetworkManager) и [Systemd-networkd](https://manpages.ubuntu.com/manpages/jammy/man5/systemd.network.5.html)), которые также можно избрать в рамках написания YAML.

Чтобы перейти с NetworkManager на systemd-networkd нужно выполнить ряд следующих действий:

```shell
sudo systemctl disable NetworkManager
sudo systemctl stop NetworkManager
sudo systemctl enable systemd-networkd
# Настраиваем вручную файлы в /etc/systemd/network
sudo systemctl start systemd-networkd
```

## Как это работает?

Netplan читает конфигурацию из каталога `/etc/netplan/*.yaml` при каждой загрузке ОС (есть команды для принудительного рендеринга). Netplan генерирует низкоуровневые конфиги и помещает их в `/run`, где ими уже руководствуется сетевой демон.

## Как этим пользоваться

### Создаём конфигурации

В указанном месте мы можем создать достаточно сложную структуру, но нужно понимать, что без каких-либо конфигураций netplan просто не будет работать. Самой простой, можно сказать, заглушкой можно посчитать следующий набор параметров:

```yaml
network:
  version: 2
  renderer: NetworkManager
```

Используя это, NetworkManager настроит имеющиеся сетевые интерфейсы по умолчанию, то есть поднимет их переведёт в режим получения в сетях, к которым они подключены сервера DHCP, который и выдаст им IP.

### Выполняем команды

Netplan'ом можно управлять при помощи следующих команд:

- `netplan generate` - использует содержимое из `/etc/netplan`, чтобы сгенерировать необходимые конфигурации для рендеров.
- `netplan apply` - рендерит конфигурации, и по необходимости перезапускает демон.
- `netplan try` - рендерит конфигурации и ждёт подтверждение от пользователя. Можно не применять изменения и откатиться назад, если согласно выводу программы нас ожидает крах сети.
