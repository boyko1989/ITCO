# Диалог от 09.04.2023

[К содержанию раздела](README.md)

## Скажи, что означают цифры в секции load average вывода таких команд как htop

Секция load average в выводе команды htop обычно содержит три числа, разделенные запятыми. Эти числа представляют собой среднюю загрузку процессора за последние 1, 5 и 15 минут соответственно. Например, если значения в секции load average равны 0.05, 0.10, 0.15, то это означает, что в среднем за последние 1, 5 и 15 минут процессор был загружен на 5%, 10% и 15% соответственно. Эти значения могут помочь вам определить, насколько сильно нагружен ваш компьютер в данный момент. Если значения в секции load average находятся на высоком уровне в течение продолжительного времени, это может указывать на проблемы с производительностью вашей системы.

## То есть это процент загрузки одного ядра процессора?

Нет, значения в секции load average в выводе команды htop не представляют собой процент загрузки одного ядра процессора, а показывают общую среднюю загрузку процессора за указанные промежутки времени. Если у вас на компьютере многоядерный процессор, то каждое ядро может быть загружено на разное количество процессов, и значения в секции load average будут отображать загрузку всех ядер в целом. Если значение load average равно 1, это означает, что одно ядро процессора было максимально загружено в течение указанного промежутка времени, а значение 2, например, означает, что два ядра были загружены на 100%, либо четыре ядра на 50%, и т.д.

## Ну то есть сумма средних процентов загрузки отдельных ядер процессора?

Да, вы можете рассматривать значения в секции load average в выводе команды htop как сумму средних процентов загрузки отдельных ядер процессора за указанные промежутки времени. Например, если у вас 4-ядерный процессор, и значения load average равны 0.5, 1.0 и 1.5 соответственно, то это означает, что в среднем за последние 1, 5 и 15 минут все ядра процессора были загружены на 12.5%, 25% и 37.5% соответственно. При этом каждое ядро могло быть загружено на разное количество процессов в зависимости от их приоритетов и других факторов.

## А в секции Server Load системы виртуализации Proxmox предполагается тот же принцип?

Да, в секции Server Load в системе виртуализации Proxmox также используется принцип load average для определения загрузки сервера. Эта секция отображает три значения load average, соответствующие последней минуте, последним 5 минутам и последним 15 минутам. В отличие от вывода команды htop, где значения load average суммируют загрузку всех ядер процессора, в Proxmox значения load average измеряют общую загрузку физического сервера, на котором работает система виртуализации, включая загрузку процессора, оперативной памяти и дисковой подсистемы. Эти значения могут помочь вам определить, насколько сильно нагружен ваш физический сервер в данный момент и какие ресурсы могут быть наиболее загружены.

## Есть ещё параметр CPU usage какой формулой связаны CPU usage и Load average?

Параметр CPU usage (использование процессора) в Proxmox связан с параметром load average, но формула для расчета CPU usage несколько отличается от формулы для расчета load average.

Значение CPU usage в Proxmox отображается в процентах и показывает текущую загрузку процессора. Формула для расчета CPU usage в Proxmox следующая:

CPU usage = (1 - (idle_time / uptime)) \* 100,

где idle_time - время, в течение которого процессор был в неактивном состоянии, а uptime - общее время работы системы.

Значение load average в Proxmox, как я уже упоминал, отображает среднюю загрузку сервера за последние 1, 5 и 15 минут. Формула для расчета load average такова:

load average = (number_of_active_processes_in_last_1_minute + 2 \* number_of_active_processes_in_last_5_minutes + 3 \* number_of_active_processes_in_last_15_minutes) / 6,

где number_of_active_processes_in_last_1_minute, number_of_active_processes_in_last_5_minutes и number_of_active_processes_in_last_15_minutes - это количество активных процессов на сервере за последние 1, 5 и 15 минут соответственно.

Таким образом, CPU usage и load average связаны между собой, но формулы для их расчета разные и отображаемые значения имеют разный смысл.

## А почему в последней формуле берётся удвоенное количество активных процессов за 5 минут и утроенное количество за 15 минут?

В формуле для расчета load average в Proxmox используется взвешенное среднее, где количество активных процессов за последние 1, 5 и 15 минут учитывается с разными весами. Это связано с тем, что активность процессов на сервере может меняться со временем, и более свежие данные о загрузке должны иметь больший вес при расчете средней загрузки.

В формуле для расчета load average количество активных процессов за последние 5 минут учитывается с весом 2, а за последние 15 минут - с весом 3. Это означает, что активность процессов за последние 5 минут имеет в два раза больший вес, чем за последние 1 минуту, а за последние 15 минут - в три раза больший вес, чем за последние 1 минуту. Это позволяет более точно отразить текущую загрузку сервера, учитывая более свежие данные о загрузке.

Таким образом, формула для расчета load average в Proxmox использует взвешенное среднее, где количество активных процессов за последние 1, 5 и 15 минут учитывается с разными весами, чтобы получить более точную оценку текущей загрузки сервера.

## Это как-то вычислили или пришли опытным путём к этим весам?

Формула для расчета load average с взвешенным средним была разработана летом 1979 года Робертом Хэндсоном (Robert W. Hamming), выдающимся американским математиком и компьютерным ученым. Хэндсон предложил использовать веса 0.5 для последней минуты, 0.3 для последних 5 минут и 0.2 для последних 15 минут. Эти значения взвешенных коэффициентов были получены на основе эмпирических наблюдений за процессами в системах с временным разрешением в несколько секунд, минут и часов.

Однако, с течением времени, эти коэффициенты были скорректированы для оптимального отображения текущей загрузки сервера в зависимости от условий работы. В Linux, которая использует формулу с взвешенным средним, коэффициенты были изменены до текущих значений 1, 2 и 3 для последних 1, 5 и 15 минут соответственно.

Таким образом, значения взвешенных коэффициентов для расчета load average были получены опытным путем и изменены со временем для оптимального отображения текущей загрузки сервера в различных условиях работы.
